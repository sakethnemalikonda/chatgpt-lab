<!--update above code to add the label in html below the gas container.To the right of the gas container have a small box that explains the kinetic theory of gases and have the relavent equation below it-->

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Diatomic Helium Simulation (2D)</title>
  <style>
    body {
      background-color: #111;
      color: white;
      font-family: monospace;
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
    }
    #container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    canvas {
      background-color: #000;
    }
    #temperature {
      margin-top: 10px;
      font-size: 16px;
    }
    #info-box {
      margin-left: 30px;
      padding: 10px;
      background-color: #222;
      border: 1px solid #555;
      border-radius: 8px;
      max-width: 300px;
    }
    #info-box h2 {
      margin-top: 0;
      font-size: 18px;
      color: #00ffff;
    }
    #info-box p, #info-box code {
      font-size: 14px;
      line-height: 1.5;
    }
    code {
      display: block;
      background-color: #000;
      padding: 5px;
      border-radius: 5px;
      color: #0f0;
    }
  </style>
</head>
<body>
<div id="container">
  <canvas id="canvas" width="800" height="600"></canvas>
  <div id="temperature">Temperature: Calculating...</div>
</div>
<div id="info-box">
  <h2>Kinetic Theory of Gases</h2>
  <p>
    The temperature of a gas is related to the average kinetic energy of its particles.
    In two dimensions:
  </p>
  <code>
    T = (2 &times; KE<sub>avg</sub>) / (f &times; k<sub>B</sub>)<br>
    f = degrees of freedom = 2 (in 2D)<br>
    k<sub>B</sub> = 1.38 × 10⁻²³ J/K
  </code>
  <p>
    KE<sub>avg</sub> is the average kinetic energy of helium nuclei in the simulation.
  </p>
</div>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const WIDTH = canvas.width;
const HEIGHT = canvas.height;
const tempLabel = document.getElementById('temperature');

const NUM_MOLECULES = 20;
const RADIUS = 4;
const BOND_LENGTH = 20;
const EPSILON = 0.2;
const SIGMA = 10;
const KB = 1.380649e-23;
const MASS_HE = 6.6465e-27;
const MASS_SIM = 1;

class Atom {
  constructor(x, y, vx, vy) {
    this.x = x;
    this.y = y;
    this.vx = vx;
    this.vy = vy;
  }

  update(dt) {
    this.x += this.vx * dt;
    this.y += this.vy * dt;
    if (this.x < RADIUS || this.x > WIDTH - RADIUS) this.vx *= -1;
    if (this.y < RADIUS || this.y > HEIGHT - RADIUS) this.vy *= -1;
    this.x = Math.max(RADIUS, Math.min(WIDTH - RADIUS, this.x));
    this.y = Math.max(RADIUS, Math.min(HEIGHT - RADIUS, this.y));
  }

  draw() {
    ctx.beginPath();
    ctx.arc(this.x, this.y, RADIUS, 0, Math.PI * 2);
    ctx.fillStyle = 'cyan';
    ctx.fill();
  }

  kineticEnergy() {
    return 0.5 * MASS_SIM * (this.vx * this.vx + this.vy * this.vy);
  }
}

class Molecule {
  constructor() {
    let x = Math.random() * (WIDTH - 2 * BOND_LENGTH) + BOND_LENGTH;
    let y = Math.random() * (HEIGHT - 2 * RADIUS) + RADIUS;
    let vx = (Math.random() - 0.5) * 100;
    let vy = (Math.random() - 0.5) * 100;
    this.a1 = new Atom(x - BOND_LENGTH/2, y, vx, vy);
    this.a2 = new Atom(x + BOND_LENGTH/2, y, vx, vy);
  }

  applyBond(dt) {
    const dx = this.a2.x - this.a1.x;
    const dy = this.a2.y - this.a1.y;
    const dist = Math.sqrt(dx*dx + dy*dy);
    const stretch = dist - BOND_LENGTH;
    const k = 5;
    const force = -k * stretch;
    const fx = force * dx / dist;
    const fy = force * dy / dist;
    this.a1.vx += fx * dt;
    this.a1.vy += fy * dt;
    this.a2.vx -= fx * dt;
    this.a2.vy -= fy * dt;
  }

  applyVanDerWaals(other, dt) {
    for (let atomA of [this.a1, this.a2]) {
      for (let atomB of [other.a1, other.a2]) {
        let dx = atomB.x - atomA.x;
        let dy = atomB.y - atomA.y;
        let r = Math.sqrt(dx * dx + dy * dy);
        if (r < 2 * BOND_LENGTH && r > 1) {
          let F = (24 * EPSILON / r) * (2 * (SIGMA / r)**12 - (SIGMA / r)**6);
          let fx = F * dx / r;
          let fy = F * dy / r;
          atomA.vx -= fx * dt;
          atomA.vy -= fy * dt;
          atomB.vx += fx * dt;
          atomB.vy += fy * dt;
        }
      }
    }
  }

  update(dt) {
    this.applyBond(dt);
    this.a1.update(dt);
    this.a2.update(dt);
  }

  draw() {
    ctx.beginPath();
    ctx.moveTo(this.a1.x, this.a1.y);
    ctx.lineTo(this.a2.x, this.a2.y);
    ctx.strokeStyle = 'white';
    ctx.stroke();
    this.a1.draw();
    this.a2.draw();
  }

  totalKineticEnergy() {
    return this.a1.kineticEnergy() + this.a2.kineticEnergy();
  }
}

const molecules = [];
for (let i = 0; i < NUM_MOLECULES; i++) {
  molecules.push(new Molecule());
}

let lastTime = performance.now();
function animate(time) {
  const dt = (time - lastTime) / 1000;
  lastTime = time;
  ctx.clearRect(0, 0, WIDTH, HEIGHT);

  for (let i = 0; i < molecules.length; i++) {
    for (let j = i + 1; j < molecules.length; j++) {
      molecules[i].applyVanDerWaals(molecules[j], dt);
    }
  }

  let totalKE = 0;
  for (let m of molecules) {
    m.update(dt);
    m.draw();
    totalKE += m.totalKineticEnergy();
  }

  let N = molecules.length * 2;
  let f = 2;
  let T = (2 * totalKE * (MASS_HE / MASS_SIM)) / (f * N * KB);
  tempLabel.innerText = `Temperature: ${T.toExponential(3)} K`;

  requestAnimationFrame(animate);
}

animate(lastTime);
</script>
</body>
</html>
